Menu="Utilities"
Type="xmenu"
Title="Docker Stats"
Icon="icon-docker"
---
<?php
$plugin = "docker-stats";
$cfg_file = "/boot/config/plugins/{$plugin}/{$plugin}.cfg";

// Read config with defaults
$cfg = @parse_ini_file($cfg_file) ?: [];
$container_limit = isset($cfg['CONTAINER_LIMIT']) ? intval($cfg['CONTAINER_LIMIT']) : 10;
$refresh_interval = isset($cfg['REFRESH_INTERVAL']) ? intval($cfg['REFRESH_INTERVAL']) : 3;

// Validate ranges
if ($container_limit < 5) $container_limit = 5;
if ($container_limit > 50) $container_limit = 50;
if ($refresh_interval < 1) $refresh_interval = 1;
if ($refresh_interval > 30) $refresh_interval = 30;
?>

<form markdown="1" method="POST" action="/update.php" target="progressFrame">
<input type="hidden" name="#file" value="<?=$plugin?>/<?=$plugin?>.cfg">
<input type="hidden" name="#command" value="">

<dl>
    <dt>Number of Containers to Display:</dt>
    <dd>
        <select name="CONTAINER_LIMIT" size="1">
            <?php
            for ($i = 5; $i <= 50; $i += 5) {
                $selected = ($i == $container_limit) ? 'selected' : '';
                echo "<option value=\"{$i}\" {$selected}>{$i}</option>";
            }
            ?>
        </select>
    </dd>
</dl>

<blockquote class="inline_help">
    <p>Set the maximum number of containers to display in the Docker Stats widget.</p>
    <p>Containers are sorted by the selected metric (CPU or Memory usage) and the top N containers are shown.</p>
    <p><strong>Range:</strong> 5 to 50 containers (in increments of 5)</p>
    <p><strong>Default:</strong> 10 containers</p>
</blockquote>

<dl>
    <dt>Refresh Interval (seconds):</dt>
    <dd>
        <select name="REFRESH_INTERVAL" size="1">
            <?php
            $intervals = [1, 2, 3, 5, 10, 15, 30];
            foreach ($intervals as $val) {
                $selected = ($val == $refresh_interval) ? 'selected' : '';
                echo "<option value=\"{$val}\" {$selected}>{$val}</option>";
            }
            ?>
        </select>
    </dd>
</dl>

<blockquote class="inline_help">
    <p>Set how frequently the Docker Stats widget updates.</p>
    <p>Lower values provide more real-time data but may increase system load.</p>
    <p><strong>Range:</strong> 1 to 30 seconds</p>
    <p><strong>Default:</strong> 3 seconds</p>
</blockquote>

<dl>
    <dt>
        <input type="submit" name="#default" value="Restore Defaults">
    </dt>
    <dd>
        <span>
            <input type="submit" name="#apply" value="Apply">
            <button type="button" onclick="done()">Done</button>
        </span>
    </dd>
</dl>

</form>
